
# üïµÔ∏è MASTER TEST PLAN: Patinhas na Lua (Full System Audit) - COMPLETO
Data: 2026-01-01
Status: P√ìS-RESET DA BASE DE DADOS

Este documento cont√©m o gui√£o EXAUSTIVO para validar **cada ecr√£** e **cada funcionalidade**.

================================================================================
üü¢ FASE 1: LANDING PAGE & AUTENTICA√á√ÉO (Visitante)
================================================================================

### 1.1. Landing Page (`/`)
- [ ] **Carregamento:** A p√°gina carrega em < 2 segundos?
- [ ] **Hero Section:**
    - [ ] Texto principal "Mime o seu melhor amigo" vis√≠vel e correto.
    - [ ] Imagem de fundo/v√≠deo carrega corretamente.
- [ ] **Bot√£o CTA (Call to Action):**
    - [ ] Bot√£o "Agendar Agora" vis√≠vel.
    - [ ] Clicar no bot√£o se **N√ÉO LOGADO** -> Redireciona para `/sign-in`.
    - [ ] Clicar no bot√£o se **J√Å LOGADO** -> Redireciona para `/dashboard`.
- [ ] **Footer:**
    - [ ] Links de redes sociais funcionam (se existirem).
    - [ ] Copyright atualizado.

### 1.2. Registo & Login (`/sign-up`, `/sign-in`) - Via Clerk
- [ ] **Registo (Sign Up):**
    - [ ] Tentar registar com email inv√°lido (ex: `teste`). Erro aparece?
    - [ ] Registar com sucesso (ex: `teste+qa1@gmail.com`).
    - [ ] Verificar se redireciona para `/onboarding` (primeira vez).
- [ ] **Login (Sign In):**
    - [ ] Login com credenciais erradas -> Erro visual?
    - [ ] Login com credenciais certas -> Entra?
    - [ ] Login com Google (Sso) -> Funciona?
- [ ] **Recupera√ß√£o de Password:**
    - [ ] Clicar em "Forgot Password". Recebe email?

### 1.3. Onboarding (`/onboarding`)
*Processo obrigat√≥rio para novos users sem perfil na BD.*
- [ ] **Valida√ß√£o de Campos:**
    - [ ] Tentar submeter formul√°rio vazio. Erros a vermelho aparecem?
    - [ ] Tentar NIF inv√°lido (ex: `123`).
    - [ ] Tentar Telefone inv√°lido (ex: `abc`).
- [ ] **Fluxo de Sucesso:**
    - [ ] Preencher Nome, NIF (9 d√≠gitos), Tlm (9 d√≠gitos), Morada.
    - [ ] Clicar "Continuar".
    - [ ] Redireciona para `/dashboard`?
    - [ ] **BD:** O utilizador foi criado na tabela `User`?

================================================================================
üîµ FASE 2: DASHBOARD DO CLIENTE (√Årea Privada)
================================================================================

### 2.1. Dashboard Home (`/dashboard`)
- [ ] **Header:** Mostra o Avatar do user no canto?
- [ ] **Banner:** "Bem-vindo de volta" personalizado?
- [ ] **Review Prompt (Condicional):**
    - [ ] Se tiver consulta conclu√≠da pendente de review -> Aparece cart√£o Dourado?
    - [ ] Se n√£o tiver -> N√£o aparece.
    - [ ] Testar submiss√£o de review (5 estrelas). Cart√£o desaparece?
- [ ] **Referral Card (Roxo):**
    - [ ] Bot√£o "Gerar C√≥digo" (se n√£o tiver).
    - [ ] C√≥digo vis√≠vel (ex: `JOAO123`)?
    - [ ] Contador de amigos convidados come√ßa a 0?
    - [ ] Bot√£o "Copiar" -> Notifica√ß√£o Toast "Copiado!"?
- [ ] **Loyalty Card (Azul):**
    - [ ] Mostra pontos corretos?
    - [ ] Clicar -> Vai para `/dashboard/rewards`?

### 2.2. Gest√£o de Animais (`/dashboard/pets`)
- [ ] **Listagem Vazia:** Mensagem amig√°vel se 0 pets.
- [ ] **Adicionar Pet:**
    - [ ] Modal abre?
    - [ ] Preencher dados.
    - [ ] Testar C√ÉO vs GATO (Esp√©cies).
    - [ ] Testar upload de FOTO. Imagem aparece na preview?
    - [ ] Salvar. Pet aparece na lista imediatamente (sem F5)?
- [ ] **Editar Pet:**
    - [ ] Mudar peso de "Pequeno" para "Grande". (Importante para pre√ßo).
    - [ ] Salvar. Altera√ß√£o persiste?
- [ ] **Remover Pet:**
    - [ ] Clicar remover. Pede confirma√ß√£o?
    - [ ] Confirmar. Pet desaparece?

### 2.3. O "Cora√ß√£o": Agendamento (`/dashboard/book`) -- TESTE PROFUNDO
- [ ] **Navega√ß√£o (Steps):** Barra de progresso (1, 2, 3, 4, 5) atualiza?
- [ ] **Passo 1: Sele√ß√£o de Pet**
    - [ ] Mostra os pets criados?
    - [ ] Selecionar Pet -> Avan√ßa auto ou habilita bot√£o?
- [ ] **Passo 2: Localiza√ß√£o**
    - [ ] Selecionar "Sal√£o" -> Taxa deve ser 0.
    - [ ] Selecionar "Domic√≠lio":
        - [ ] Mapa carrega?
        - [ ] Clicar no mapa (Zona Verde) -> Taxa calculada (ex: 5‚Ç¨)?
        - [ ] Clicar longe (Zona Vermelha) -> Erro "Fora de zona"?
        - [ ] Escrever morada manual na barra -> Funciona?
- [ ] **Passo 3: Servi√ßos**
    - [ ] A lista filtra corretamente? (ex: Se escolhi GATO, n√£o deve mostrar tosquia de C√ÉO).
    - [ ] Selecionar servi√ßo.
- [ ] **Passo 4: Data & Hora (Calend√°rio)**
    - [ ] Dias passados bloqueados (cinzentos)?
    - [ ] Dias fechados (Domingo ou Feriados configurados) bloqueados?
    - [ ] **Slots:**
        - [ ] Clicar num dia. As horas aparecem?
        - [ ] As horas respeitam o almo√ßo (12:30-14:00)?
        - [ ] As horas respeitam a dura√ß√£o do servi√ßo? (ex: Se servi√ßo √© 2h, n√£o mostra 17:30 se fecha √†s 18:00).
    - [ ] **Recorr√™ncia (Feature Growth):**
        - [ ] Ativar "Repetir a cada 4 semanas".
        - [ ] Verificar texto explicativo.
- [ ] **Passo 5: Resumo (Checkout)**
    - [ ] **C√°lculo:** Pre√ßo Servi√ßo + Taxa Domic√≠lio est√° correto?
    - [ ] **Cup√£o/Referral:**
        - [ ] Inserir c√≥digo inv√°lido. Erro?
        - [ ] Inserir c√≥digo de amigo (`AMIGO123`). Sucesso?
        - [ ] Desconto (5%) calculado certo?
    - [ ] **NIF:** Checkbox "Na fatura" funciona?
- [ ] **Submiss√£o:**
    - [ ] Clicar "Agendar". Loading state?
    - [ ] Sucesso -> Redireciona? Email de confirma√ß√£o enviado (Log console)?
    - [ ] Se recorrente -> Criou 6 agendamentos?

### 2.4. Hist√≥rico (`/dashboard/history`)
- [ ] Filtros: "Agendados", "Conclu√≠dos", "Cancelados" funcionam?
- [ ] Bot√£o "Cancelar" em agendamento futuro:
    - [ ] Funciona?
    - [ ] Atualiza status para CANCELLED?

### 2.5. Loyalty Rewards (`/dashboard/rewards`)
- [ ] Saldo vis√≠vel?
- [ ] Lista de pr√©mios.
- [ ] Pr√©mios bloqueados (cinzentos) se saldo insuficiente?
- [ ] Pr√©mios ativos se saldo ok?
- [ ] Clicar "Usar" -> Gera QR Code?

### 2.6. Perfil (`/dashboard/profile`)
- [ ] Editar dados pessoais (Telefone, Morada).
- [ ] Salvar. Persiste?

================================================================================
üî¥ FASE 3: BACKOFFICE DE GEST√ÉO (√Årea Admin)
================================================================================

### 3.1. Dashboard Admin (`/admin`)
- [ ] **M√©tricas:** Valores > 0?
- [ ] **Gr√°ficos:** Renderizam sem erros?

### 3.2. Agenda (`/admin/appointments`) -- GEST√ÉO DI√ÅRIA
- [ ] **Calend√°rio/Lista:**
    - [ ] O agendamento criado no passo 2.3 aparece aqui?
    - [ ] Detalhes (Pet, Cliente, Servi√ßo) est√£o certos?
- [ ] **Mudan√ßa de Estado:**
    - [ ] "Confirmar" -> Muda cor/estado?
    - [ ] "Iniciar" (Check-in) -> Funciona?
- [ ] **Pagamento & Conclus√£o (Checkout):**
    - [ ] Bot√£o "Registar Pagamento".
    - [ ] Selecionar M√©todo (Numer√°rio/MBWay).
    - [ ] Valor edit√°vel (para gorjetas/extras)?
    - [ ] Confirmar -> Estado passa a COMPLETED?
    - [ ] Gerou Fatura (Rascunho)?

### 3.3. Clientes (`/admin/clients`)
- [ ] **Listagem:** Pagina√ß√£o funciona?
- [ ] **Pesquisa:** Buscar pelo nome do "Cliente Teste".
- [ ] **Ficha Cliente:**
    - [ ] Ver hist√≥rico de visitas desse cliente.
    - [ ] Ver total gasto (LTV)?

### 3.4. Servi√ßos (`/admin/services`)
- [ ] **CRUD:**
    - [ ] Criar Servi√ßo "Teste".
    - [ ] Adicionar Op√ß√£o de Pre√ßo (Tamanho S, Pelo Curto = 10‚Ç¨).
    - [ ] Editar Servi√ßo.
    - [ ] Apagar Servi√ßo. (Cuidado com integridade referencial).

### 3.5. Defini√ß√µes (`/admin/settings`)
- [ ] **Hor√°rios:**
    - [ ] Alterar hora de abertura.
    - [ ] Adicionar dia de F√©rias (Aus√™ncia).
- [ ] **Global:** Mudar morada base da empresa.

### 3.6. Scanner (`/admin/scan`)
- [ ] Aceder via telem√≥vel. C√¢mara abre?
- [ ] Ler QR Code gerado no passo 2.5.
- [ ] Valida o pr√©mio? Desconta os pontos ao cliente?

================================================================================
üß™ CEN√ÅRIOS DE ERRO & LIMITES (QA AVAN√áADO)
================================================================================

1.  **Concorr√™ncia:** Abrir dois browsers. Tentar reservar a MESMA hora ao MESMO tempo. O segundo deve falhar.
2.  **Referral Loop:** Tentar usar o *pr√≥prio* c√≥digo de convite. O sistema deve impedir (Autorefer√™ncia √© proibida).
3.  **Cancelamento Tardio:** Tentar cancelar consulta que √© "hoje". O sistema permite? (Defini√ß√£o de pol√≠tica).
4.  **XSS na Review:** Tentar escrever `<script>alert('oi')</script>` no coment√°rio da review. O sistema deve sanitizar.
5.  **Admin Protection:** Tentar aceder a `/admin` com user normal. Deve dar "Unauthorized" ou Redirect home.

---

**FIM DO GUI√ÉO.**
Se todos os testes passarem, o software est√° aprovado para entrar em produ√ß√£o.
